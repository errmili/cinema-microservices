name: Cinema CI - Premier Test

# Quand dÃ©clencher ce pipeline
on:
  push:
    branches: [ main ]  # Quand tu push sur main
  pull_request:
    branches: [ main ]  # Ou quand tu fais une pull request

jobs:
  # =================== JOB 1: BUILD ET TEST ===================
  build-test:
    runs-on: ubuntu-latest

    steps:
      # Ã‰tape 1: RÃ©cupÃ©rer ton code
      - name: ğŸ“¥ RÃ©cupÃ©rer le code
        uses: actions/checkout@v3

      # Ã‰tape 2: Installer Java 17
      - name: â˜• Installer Java 17
        uses: actions/setup-java@v3
        with:
          java-version: '17'
          distribution: 'temurin'

      # Ã‰tape 3: Cache Maven (pour aller plus vite)
      - name: ğŸ“¦ Cache Maven
        uses: actions/cache@v3
        with:
          path: ~/.m2
          key: ${{ runner.os }}-m2-${{ hashFiles('**/pom.xml') }}

      # Ã‰tape 4: Build chaque service UN PAR UN
      - name: ğŸ”¨ Build Discovery Server
        run: |
          echo "ğŸš€ Build du Discovery Server..."
          cd discovery-server
          mvn clean compile
          echo "âœ… Discovery Server compilÃ©!"

      - name: ğŸ”¨ Build Config Server
        run: |
          echo "ğŸš€ Build du Config Server..."
          cd config-server
          mvn clean compile
          echo "âœ… Config Server compilÃ©!"

      - name: ğŸ”¨ Build Gateway API
        run: |
          echo "ğŸš€ Build du Gateway..."
          cd gateway-api
          mvn clean compile
          echo "âœ… Gateway compilÃ©!"

      - name: ğŸ”¨ Build Service Film
        run: |
          echo "ğŸš€ Build du Service Film..."
          cd service-film
          mvn clean compile
          echo "âœ… Service Film compilÃ©!"

      - name: ğŸ”¨ Build Cinema Service
        run: |
          echo "ğŸš€ Build du Cinema Service..."
          cd cinema
          mvn clean compile
          echo "âœ… Cinema Service compilÃ©!"

      - name: ğŸ”¨ Build User Management
        run: |
          echo "ğŸš€ Build du User Management..."
          cd user-management
          mvn clean compile
          echo "âœ… User Management compilÃ©!"

      - name: ğŸ”¨ Build Booking Service
        run: |
          echo "ğŸš€ Build du Booking Service..."
          cd service-reservation
          mvn clean compile
          echo "âœ… Booking Service compilÃ©!"

      # Ã‰tape 5: Message de fin
      - name: ğŸ‰ Build terminÃ©
        run: |
          echo "ğŸ‰ Tous les services ont Ã©tÃ© compilÃ©s avec succÃ¨s!"
          echo "ğŸš€ Ton architecture microservices est prÃªte!"